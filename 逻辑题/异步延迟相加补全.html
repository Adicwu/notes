<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title></title>
	</head>
	<body></body>
	<script type="text/javascript">
		/**
		 * 请在 sum函数中调用此函数，完成数值计算
		 * @param {*} a 要相加的第一个值
		 * @param {*} b 要相加的第二个值
		 * @param {*} callback 相加之后的回调函数
		 */
		function asyncAdd(a, b, callback) {
			setTimeout(function() {
				callback(null, a + b)
			}, 1000)
		}

		/**
		 * 请在此方法中调用asyncAdd方法，完成数值计算
		 * @param  {...any} rest 传入的参数
		 */
		async function sum(...rest) {
			// 请在此处完善代码
			let result = 0,
				obj = {};
			// 每次读取obj(只有数组或对象)时会调用valueOf
			obj.valueOf = function() {
				return result
			};
			await Promise.all(rest.map(item => {
				return new Promise(resolve => {
					asyncAdd(obj, item, (_, res) => {
						resolve(res)
					})
				}).then(res => {
					result = res
				})
			}))
			return result
		}

		let start = window.performance.now()
		sum(1, 2, 3).then(res => {
			// 请保证在调用sum方法之后，返回结果21
			console.log(res)
			console.log(`程序执行共耗时: ${window.performance.now() - start}`)
		})
	</script>
</html>
