### 三次握手

首先，服务器和浏览器各有一个准备状态；第一次握手，浏览器请求服务器，浏览器为半打开；第二次握手，服务器接到，并请求浏览器，此时服务器为半打开；第三次握手，浏览器接到，并请求服务器，浏览器全打开；最终服务器接到，并转换为打开状态

#### 为什么不是两次握手

假设我们第一次服务器向浏览器请求，而这一次遇到网络问题导致停滞，于是浏览器又重新请求（实际上上一次请求还在等待状态）；最终服务器与浏览器在第二次请求时成功建立链接；次数第一次请求顺利发送，而服务器接到后又与浏览器进行链接，但浏览器却已经连接，就造成服务器开了一个无效链接。终上所述，如果是三次握手的话，服务器就能完整的知道自己是否需要创建一个有效链接；所以三次握手实际上是一种网络波动的解决方案

![](E:\Code\笔记\Md\杂\QQ图片20220803220435.png)

### 四次挥手

- 第一次挥手，浏览器请求服务器，告诉服务器我要结束了，然后自己开始进入结束等待；

- 第二次挥手，服务器接到，并请求浏览器，告诉浏览器我准备结束了，并开始进入结束等待。

- 期间，服务器仍然能发送未发送完成内容，浏览器仍然能接受内容

- 第三次挥手，等待服务器正在发送内容完成后，请求浏览器，并进入结束确认状态

- 第四次挥手，浏览器收到确认结束请求后，请求服务器，服务器接收到后立刻结束链接；浏览器进入超时等待，然后等待后关闭（进入等待是因为此次挥手如果遇到网络波动，会导致服务器无法接收确认信息并无法结束；故在出现此状况时会再次执行第三、四次挥手的请求）


![](E:\Code\笔记\Md\杂\QQ图片20220803223423.png)

### 什么时候才会进行上面的步骤

在早期http1.0的时候，每进行一次请求，就会触发一次步骤验证（三次握手）；到后来的http1.1时，改用了持久连接，就是在一次连接后，如果没有明确断开连接（四次挥手），那么下一次请求就不会进行验证；

持久连接是默认开启的，相关头为 `Connection:Keep-Alive` 

### 相关链接

[一条视频讲清楚TCP协议与UDP协议-什么是三次握手与四次挥手](https://www.bilibili.com/video/BV1kV411j7hA/?spm_id_from=333.788.recommend_more_video.0&vd_source=c5594576f1a683147cded7c857af2b39)

[TCP三次握手和四次挥手](https://www.bilibili.com/video/BV18h41187Ep?spm_id_from=333.999.0.0&vd_source=c5594576f1a683147cded7c857af2b39)