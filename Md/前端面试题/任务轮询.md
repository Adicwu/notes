### 什么是任务轮询

由于js的单线程但进程执行机制（注意，其运行环境和这个没关系，比如node和浏览器），却又存在异步操作，故需要一个机制来触发同步和异步任务，这就是任务轮询

任务轮询分为三种：同步任务、微任务、宏任务

### 同步任务

就是同步的任务，其优先被执行，无可厚非，处于线程中

### 微任务Microtask

微任务是运行在线程当中的，由js发起。最古老的微任务就是我们常用的callback，所以微任务可以初步理解为 `不是在书写处执行的任务`；目前常见的微任务有 ：

- promise.then/catch/finally 
- MutationObserve
- process.nextTick
- requestAnimationFrame

优先级为`process.nextTick > Promise > MutationObserver`

### 宏任务Macrotask

则指代优先级比微任务低的异步任务，由宿主发起。他是独立存在于线程中的（因为其实时性，如果存在于线程会被阻塞），常见的宏任务有：

- setTimeout/setInterval 
- MessageChannel 跨页通讯
- setImmediate
- script 代码块
- I/O操作
- UI渲染

优先级为`script > setImmediate > MessageChannel > setTimeout/setInterval > I/O操作 > UI 渲染`

### 运行机制

![](E:\Code\笔记\Md\杂\20210421220533545.png)

一般以script代码块做为宏任务入口开始执行

- 优先执行同步任务
- 然后检查并执行微任务
- 最后执行宏任务（每一个宏任务都是一个队列，也就相当于开始了一个新的轮询）

### 问题

#### 为什么script是宏任务

上面提到，每一个队列都是一个宏任务，而由于script内部（各种类型的任务）本身是一个任务队列，这非常符合宏任务的特点

#### 为什么Observer是微任务

因为Observer是观察DOM的响应事件绑定，本身是运行是基于于DOM的，所以存在于DOM进程中的

#### 事件是什么任务

事件属于宏任务。事件的触发是依赖与浏览器的，浏览器实现了自己的事件机制（注册派发）；其独立性，所以为宏任务